---
title: "Homework 3"
author: "Christopher Crowe"
date: "October 5, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(patchwork)
```

## Problem 1

The following code chunk loads the BRFSS data and conducts the following steps:

* clean variable names
* focus on the "Overall Health" topic
* include only responses from "Excellent" to "Poor"
* organize responses as a factor taking levels from "Excellent" to "Poor"

```{r}
devtools::install_github("p8105/p8105.datasets")
library(p8105.datasets)
data("brfss_smart2010")

brfss_data = brfss_smart2010 %>%
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  filter(response == "Excellent" | response == "Very good" | response == "Good" | response == "Fair" | response == "Poor") %>%
  mutate(response = ordered(response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent")))
```

Using this cleaned dataset, we can answer/perform the following questions/tasks of interest: 

* Q: In 2002, which states were observed at 7 locations?
```{r}
brfss_data %>% 
  filter(year == 2002) %>% 
  distinct(locationabbr, locationdesc) %>% 
  group_by(locationabbr) %>% 
  summarize(observed_locations = n()) %>% 
  filter(observed_locations == 7) %>% 
  knitr::kable()
```


* A: According to the table above, Connecticut, Florida, and North Carolina each have observations from 7 distinct locations in 2002.



 * Q: Make a “spaghetti plot” that shows the number of observations in each state from 2002 to 2010.
  
```{r}
brfss_data %>% 
  filter(year >= 2002 & year <= 2010) %>% 
  group_by(locationabbr, year) %>% 
  summarize(observations = sum(sample_size)) %>% 
  ggplot(aes(x = year, y = observations, color = locationabbr)) +
    geom_line(size = 0.1) +
    labs(
      title = "Observation Plot",
      x = "Year",
      y = "Number of Observations",
      caption = "Data from BRFSS"
    ) +
    viridis::scale_color_viridis(
      name = "locationabbr",
      discrete = TRUE
    ) +
    theme_bw() +
    theme(legend.position = "bottom")
```

* A: The above "spaghetti plot" shows how many observations there were in each state by year, from 2002 to 2010. However, this graph is not very informative because it is difficult to distinguish the colors of the lines. While we we can that one state in particular had an unusually high number of observations in 2007, it is hard to tell which state corresponds to this color. Additionally, because there are so many lines on top of each other at the bottom of the graph, it is extremely difficult to distinguish one line from another. 

* Q: Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.

```{r}
brfss_data %>% 
  filter(locationabbr == "NY" & response == "Excellent" & (year == 2002 | year == 2006 | year == 2010)) %>% 
  mutate(proportion_excellent = data_value / 100) %>% 
  group_by(year) %>% 
  summarize(mean_proportion_excellent = mean(proportion_excellent), sd_proportion_excellent = sd(proportion_excellent)) %>% 
  knitr::kable()
```

 
 * A: From this table, we can see that the proportion of individuals in NY with excellent overall health has decreased from 0.24 in 2002 but has remained somewhat constant around 0.22 since 2006. 


* Q: For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.

```{r}

brfss_data %>% 
  mutate(proportion = data_value / 100) %>% 
  group_by(year, locationabbr, response) %>% 
  summarize(mean_proportion = mean(proportion)) %>% 
  ggplot(aes(x = year, y = mean_proportion, color = locationabbr)) +
    geom_point() +
    scale_x_continuous(breaks = c(2003, 2006, 2009)) +
    facet_grid(~response) +
    labs(
      title = "Trends in Response to Overall Health Question by State 2002 - 2010",
      x = "Year", 
      y = "Mean Proportion",
      caption = "Data from BRFSS"
    ) +
    viridis::scale_color_viridis(
      discrete = TRUE
    ) +
    theme_bw() +
    theme(legend.position = "bottom")
```

* A: In the above graphs, it is still hard to distinguish which data point corresponds to which state, but this graphical representation is successful in showing differences in the overall mean proportions of responses. For example, we can see that across all years and states, there were relatively few "Poor" responses and a much larger proportion of "Very good" responses. We can also see that on average, the proportion of "Poor" responses had less variation (ranging from ~0.0 to ~0.1 for "Poor" vs. ~0.275 to ~4.25 for "Very good"). Additionally, we can identify the presence of outliers even if it may be difficult to discern the state (e.g. it looks like either WY or WV had a much lower proportion of excellent reponses in 2005 compared to all other states).



